# Project Structure - Fish Disease Detection System

This project is organized into **Frontend** and **Backend** components with a clear separation of concerns.

## Directory Structure

```
fish-disease-detection/
│
├── src/                    # Frontend source code (React + TypeScript)
│   ├── components/         # Reusable UI components
│   │   ├── Navigation.tsx
│   │   ├── Footer.tsx
│   │   ├── ChatBot.tsx
│   │   └── ui/            # Shadcn UI components
│   │
│   ├── pages/             # Main application pages
│   │   ├── Index.tsx             # Homepage
│   │   ├── Auth.tsx              # Sign in/Sign up
│   │   ├── FishSpecies.tsx       # Species detection
│   │   ├── DiseaseDetection.tsx  # Disease detection (calls ML backend)
│   │   ├── YieldFeed.tsx         # Yield & feed calculations
│   │   ├── PondDesign.tsx        # Pond design calculator
│   │   └── NotFound.tsx          # 404 page
│   │
│   ├── hooks/             # Custom React hooks
│   ├── lib/               # Utility functions
│   ├── integrations/      # Supabase integration
│   ├── index.css          # Global styles
│   └── main.tsx           # App entry point
│
├── public/                # Static assets
│   ├── fish-logo.png
│   └── robots.txt
│
├── backend/               # Python Flask backend (ML inference)
│   ├── app.py            # Flask API server
│   ├── train_model.py    # ResNet50 model training script
│   ├── requirements.txt  # Python dependencies
│   ├── .gitignore
│   ├── README.md         # Backend documentation
│   │
│   └── models/           # Trained ML models
│       ├── README.md     # Instructions for model placement
│       └── fish_disease_model.keras  # ⚠️ Must be placed here after training
│
├── supabase/             # Supabase configuration (Lovable Cloud)
│   ├── config.toml
│   ├── functions/        # Edge functions
│   │   ├── chat/        # AI chatbot
│   │   ├── detect-fish-disease/  # (Not used - ML backend used instead)
│   │   └── detect-fish-species/  # Species detection with weather API
│   └── migrations/       # Database migrations
│
├── .env                  # Environment variables (auto-generated)
├── .env.example          # Environment variables template
├── index.html            # HTML entry point
├── package.json          # Frontend dependencies
├── vite.config.ts        # Vite configuration
├── tailwind.config.ts    # Tailwind CSS configuration
├── PROJECT_STRUCTURE.md  # This file
└── README.md             # Main project documentation
```

## Architecture Overview

### Frontend (React + Vite)
- **Technology**: React 18, TypeScript, Vite, Tailwind CSS, Shadcn UI
- **Purpose**: User interface for all features
- **Key Features**:
  - User authentication (Supabase Auth)
  - Fish species detection
  - Fish disease detection (sends images to ML backend)
  - Yield and feed calculations
  - Pond design calculator
  - Responsive design with dark mode

### Backend (Flask + TensorFlow)
- **Technology**: Flask, TensorFlow 2.15, ResNet50, NumPy, PIL
- **Purpose**: Machine learning inference for disease detection
- **Key Features**:
  - ResNet50-based CNN model (trained on 256x256 fish images)
  - 7-class classification (6 diseases + healthy)
  - REST API endpoint for disease prediction
  - CORS enabled for frontend communication
  - ~95-97% accuracy on test set

### Database (Supabase/PostgreSQL)
- **Technology**: Supabase (via Lovable Cloud)
- **Purpose**: Data persistence and authentication
- **Tables**:
  - `profiles`: User profiles
  - `fish_species_data`: Species detection history
  - `pond_designs`: Saved pond designs

## Data Flow

### Disease Detection Flow
```
User uploads image (Frontend)
    ↓
Convert to base64 (Frontend)
    ↓
POST /detect-disease (Frontend → Backend)
    ↓
Preprocess image (Backend)
    ↓
ResNet50 prediction (Backend ML Model)
    ↓
Add disease info (Backend)
    ↓
JSON response (Backend → Frontend)
    ↓
Display results (Frontend)
```

### Other Features Flow
```
User interaction (Frontend)
    ↓
Calculate/Process (Frontend logic)
    ↓
Save to Supabase (if needed)
    ↓
Display results (Frontend)
```

## API Endpoints

### Backend (Flask)
- `GET /health` - Health check
- `POST /detect-disease` - Predict fish disease from image

### Frontend URLs
- `/` - Homepage
- `/auth` - Sign in/Sign up
- `/fish-species` - Species detection
- `/fish-disease` - Disease detection
- `/yield-feed` - Yield & feed calculator
- `/pond-design` - Pond design calculator

## Environment Variables

### Frontend (.env)
```
VITE_SUPABASE_URL=<auto-generated>
VITE_SUPABASE_PUBLISHABLE_KEY=<auto-generated>
VITE_SUPABASE_PROJECT_ID=<auto-generated>
VITE_FLASK_BACKEND_URL=http://localhost:5000  # or production URL
```

### Backend
No environment variables needed for basic operation. Model path is hardcoded in `app.py`.

## Development Setup

### Prerequisites
1. Node.js 18+ and npm
2. Python 3.9+ 
3. Trained model file at `backend/models/fish_disease_model.keras`

### Frontend Setup
```bash
# Install dependencies
npm install

# Start development server (runs on http://localhost:5173)
npm run dev
```

### Backend Setup
```bash
# Navigate to backend directory
cd backend

# Install Python dependencies
pip install -r requirements.txt

# IMPORTANT: Place your trained model file here
# backend/models/fish_disease_model.keras

# OR train the model yourself (requires dataset)
python train_model.py

# Start Flask server (runs on http://localhost:5000)
python app.py
```

### Environment Configuration
Ensure `.env` file has the Flask backend URL:
```
VITE_FLASK_BACKEND_URL=http://localhost:5000
```

## Deployment

### Frontend
- Deploy via Lovable (automatic)
- Or deploy to Vercel/Netlify

### Backend
- **Local**: Run Flask on localhost:5000
- **Heroku**: `git push heroku main`
- **AWS EC2**: Deploy with gunicorn + nginx
- **Google Cloud Run**: Deploy containerized app
- **Railway/Render**: Connect GitHub repo

Update `VITE_FLASK_BACKEND_URL` in frontend `.env` to point to deployed backend.

## Technology Stack Summary

| Component | Technology |
|-----------|-----------|
| Frontend Framework | React 18 + TypeScript |
| Build Tool | Vite |
| Styling | Tailwind CSS + Shadcn UI |
| Backend Framework | Flask (Python) |
| ML Framework | TensorFlow 2.15 |
| ML Model | ResNet50 (pre-trained + fine-tuned) |
| Database | PostgreSQL (Supabase) |
| Authentication | Supabase Auth |
| Hosting | Lovable (Frontend), Custom (Backend) |

## Model Training Info

- **Dataset**: Freshwater Fish Disease Aquaculture (Kaggle)
- **Architecture**: ResNet50 transfer learning
- **Input Size**: 256x256 RGB
- **Training Time**: ~1-2 hours (GPU recommended)
- **Epochs**: 50 (with early stopping)
- **Batch Size**: 32
- **Data Augmentation**: Rotation, flip, zoom
- **Expected Accuracy**: 95-97%

## Important Notes

1. **⚠️ Model File Required**: The trained model file (`fish_disease_model.keras`) is **NOT** included in the repository due to its large size (~90MB). You must:
   - Train the model yourself using `python backend/train_model.py` (requires dataset), OR
   - Download a pre-trained model and place it at `backend/models/fish_disease_model.keras`
   - Ensure the model uses ResNet50 architecture with 256x256 input size

2. **Dataset Required for Training**: Download the fish disease dataset from Kaggle and place it in `backend/dataset/` before training.

3. **Separate Deployment**: Frontend (React) and Backend (Flask) are deployed separately:
   - Frontend: Deploy via Lovable or Vercel/Netlify
   - Backend: Deploy to Heroku, Railway, AWS, or Google Cloud
   - Backend must be accessible via HTTP(S) for frontend to communicate with it

4. **Local Development Workflow**:
   ```bash
   # Terminal 1 - Frontend
   npm run dev  # http://localhost:5173
   
   # Terminal 2 - Backend
   cd backend
   python app.py  # http://localhost:5000
   ```

5. **CORS Security**: Flask backend has CORS enabled for all origins (`*`) for development. **Restrict this in production** by modifying `CORS(app)` in `backend/app.py`:
   ```python
   CORS(app, origins=["https://your-frontend-domain.com"])
   ```

6. **Edge Functions**: The project uses Supabase Edge Functions for some features:
   - `detect-fish-species`: Uses OpenWeather API to determine suitable fish species
   - `chat`: AI-powered chatbot for aquaculture queries
   - `detect-fish-disease`: **Not used** (replaced by Flask ML backend)

7. **File Organization**:
   - ✅ **Frontend files**: All in `src/` directory (components, pages, hooks, etc.)
   - ✅ **Backend files**: All in `backend/` directory (Flask app, model training, model file)
   - ✅ **Supabase files**: All in `supabase/` directory (edge functions, config)
   - ✅ **Configuration**: Root level (package.json, vite.config.ts, tailwind.config.ts, etc.)
